webpackJsonp([1],{DTOE:function(t,e){},NHnr:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});r("tvR6");var a=r("qBF2"),n=r.n(a),s=(r("o8dz"),r("u7Vc"),r("7+uW")),o={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var i=r("VU/8")({name:"App"},o,!1,function(t){r("DTOE")},null,null).exports,c=r("/ocq"),l={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"OTA"})},staticRenderFns:[]};r("VU/8")({name:"HelloWorld",data:function(){return{versiosList:""}},mounted:function(){this.$http.checkCurrentVersion()}},l,!1,function(t){r("OxOP")},"data-v-40a4cf44",null).exports;var u=r("Xxa5"),d=r.n(u),p=r("exGp"),v=r.n(p),g={data:function(){return{packageList:[],newVersionList:[],size:0,tag:0,timeUsed:0,updateDetail:"",disabledDownload:!1,progress:0,showUpgrade:!1,showUpgradeProgress:!1,downloadInterval:null,versionInterval:null,upgradeInterval:null,upgradeStatus:2}},methods:{startDownload:function(){var t=this;return v()(d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.disabledDownload=!0,e.prev=1,e.next=4,t.$http.startDownload({tag:t.tag});case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return");case 9:t.checkNewVersion=function(){},clearInterval(t.versionInterval),t.downloadInterval=setInterval(function(){return t.getDownloadResult()},3e3);case 12:case"end":return e.stop()}},e,t,[[1,6]])}))()},checkNewVersion:function(){var t=this;return v()(d.a.mark(function e(){var r,a,n,s,o,i,c,l,u,p,v;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$http.checkNewVersion();case 2:r=e.sent,a=r.packageList,n=void 0===a?[]:a,s=r.size,o=void 0===s?0:s,i=r.tag,c=void 0===i?0:i,l=r.description,u=void 0===l?"":l,p=r.timeUsed,v=void 0===p?0:p,t.newVersionList=n,t.size=o,t.tag=c,t.updateDetail=u,t.timeUsed=v;case 18:case"end":return e.stop()}},e,t)}))()},openUpgrade:function(){clearInterval(this.downloadInterval),this.showUpgrade=!0},getDownloadResult:function(){var t,e=this;(t=v()(d.a.mark(function t(){var r,a,n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.getDownloadResult({tag:e.tag});case 2:r=t.sent,a=r.progress,n=r.otaStatus,e.progress=+a,"0"===n&&(e.progress=100,clearInterval(e.downloadInterval));case 7:case"end":return t.stop()}},t,e)})),function(){return t.apply(this,arguments)})()},startUpgrade:function(){var t=this;return v()(d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$http.startUpgrade({tag:t.tag});case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return");case 8:t.showUpgrade=!1,t.showUpgradeProgress=!0,t.upgradeInterval=setInterval(function(){return t.getUpgradeResult()},3e3);case 11:case"end":return e.stop()}},e,t,[[0,5]])}))()},getUpgradeResult:function(){var t,e=this;(t=v()(d.a.mark(function t(){var r,a;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.getUpgradeResult({tag:e.tag});case 2:r=t.sent,a=r.otaStatus,e.upgradeStatus=a||2,0!=+a&&1!=+a||clearInterval(e.upgradeInterval);case 6:case"end":return t.stop()}},t,e)})),function(){return t.apply(this,arguments)})()}},mounted:function(){var t=this;return v()(d.a.mark(function e(){var r,a;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$http.checkCurrentVersion();case 2:r=e.sent,a=r.packageList,t.packageList=a,t.checkNewVersion(),t.versionInterval=setInterval(function(){return t.checkNewVersion()},18e4);case 7:case"end":return e.stop()}},e,t)}))()}},f={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"ota"}},[r("el-container",[r("el-header",[r("h1",[t._v("OTA")])]),t._v(" "),r("el-main",[r("el-card",{staticClass:"box-card"},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("span",[t._v("软件更新")])]),t._v(" "),r("h4",[t._v("当前版本")]),t._v(" "),r("div",{staticClass:"list-box"},[r("ul",t._l(t.packageList,function(e,a){var n=e.moduleName,s=e.moduleVersion;return r("li",{key:a},[r("b",[t._v(t._s(n))]),t._v(" : "+t._s(s)+"\n                    ")])}),0)])]),t._v(" "),r("el-card",{staticClass:"box-card"},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t.newVersionList.length?r("div",[r("el-row",[r("el-col",{attrs:{span:8}},[r("span",{staticClass:"el-icon-info"},[t._v(" 新版本")]),t._v(" "),t.size?r("el-tag",{attrs:{type:"warning"}},[t._v(t._s((t.size/1024/1024).toFixed(2))+" MB")]):t._e()],1),t._v(" "),r("el-col",{attrs:{span:12}},[t.progress?r("el-progress",{attrs:{percentage:t.progress}}):r("span",[t._v(" ")])],1),t._v(" "),r("el-col",{attrs:{span:4}},[100!==t.progress?r("el-button",{attrs:{type:"primary",disabled:t.disabledDownload},on:{click:t.startDownload}},[t._v("下载")]):r("el-button",{attrs:{type:"primary"},on:{click:t.openUpgrade}},[t._v("安装")])],1)],1),t._v(" "),r("div",{staticClass:"list-box"},[r("ul",t._l(t.newVersionList,function(e,a){var n=e.moduleName,s=e.moduleVersion;return r("li",{key:a},[r("b",[t._v(t._s(n))]),t._v(" : "+t._s(s)+"\n                            ")])}),0)])],1):r("div",[r("el-row",[r("el-col",{attrs:{span:20}},[t._v("\n                            未检测到新版本\n                        ")]),t._v(" "),r("el-col",{attrs:{span:4}},[r("el-button",{attrs:{type:"primary"},on:{click:t.checkNewVersion}},[t._v("检查更新")])],1)],1)],1)]),t._v(" "),t.updateDetail?r("div",[r("h4",[t._v("更新日志")]),t._v(" "),r("div",{staticClass:"list-box"},[r("pre",[t._v("                        "+t._s(t.updateDetail)+"\n                    ")])])]):t._e()]),t._v(" "),r("el-dialog",{attrs:{title:"安装提示",visible:t.showUpgrade,width:"30%"},on:{"update:visible":function(e){t.showUpgrade=e}}},[r("div",{staticClass:"upgrade"},[r("h4",[t._v("软件已下载成功，是否立即安装？")]),t._v(" "),r("div",[t._v("\n                    软件安装过程中无人车将不能自动驾驶，不能断电、断网。请确保无人车已退出自动驾驶并安全停靠。\n                ")]),t._v(" "),r("div",[r("el-tag",{attrs:{type:"warning"}},[r("span",{staticClass:"el-icon-info"},[t._v("此安装大约需要")]),t._v(" "+t._s(t.timeUsed/60)+" 分钟")])],1)]),t._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(e){t.showUpgrade=!1}}},[t._v("下次再说")]),t._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:t.startUpgrade}},[t._v("安装")])],1)]),t._v(" "),r("el-dialog",{attrs:{title:"软件安装","show-close":!1,"close-on-click-modal":!1,visible:t.showUpgradeProgress,width:"30%"},on:{"update:visible":function(e){t.showUpgradeProgress=e}}},[0==t.upgradeStatus?r("div",[t._v("\n                安装成功，系统重启中。。\n            ")]):1==t.upgradeStatus?r("div",[r("h4",[t._v("安装失败。")]),t._v(" "),r("p",[t._v("遇见一未知错误，建议刷新浏览器，再次安装")])]):r("div",[r("span",{staticClass:"el-icon-loading"}),t._v(" 安装中...\n            ")])])],1)],1)],1)},staticRenderFns:[]};var h=r("VU/8")(g,f,!1,function(t){r("hc8q")},"data-v-76957df2",null).exports;s.default.use(c.a);var _=new c.a({routes:[{path:"/",name:"Ota",component:h}]}),w=r("MEK5"),k=r("yg6k"),m=r.n(k),x=r("//Fk"),b=r.n(x),U={credentials:"include",withCredentials:!0,"x-timeout":6e4,handler:{success:function(t,e){var r=t.data,a=r.status,n=r.info,s=r.description;return"0"===a?s?b.a.reject({description:s,status:a}):n:b.a.reject({description:n.description,status:a})},error:function(t){var e=t.data,r=e.description,a=void 0===r?"":r;return a&&m()({title:"Error",message:a}),b.a.reject(e)}}},V=Object(w.apify)(w.request.post,{checkCurrentVersion:"/api/check_current_version",checkNewVersion:"/api/check_new_version",startDownload:"/api/start_download",getDownloadResult:"/api/get_download_result",startUpgrade:"/api/start_upgrade",getUpgradeResult:"/api/get_upgrade_result"},U),y={install:function(t){t.prototype.$http=V}};s.default.use(y),s.default.use(n.a),s.default.config.productionTip=!1,new s.default({el:"#app",router:_,components:{App:i},template:"<App/>"})},OxOP:function(t,e){},hc8q:function(t,e){},o8dz:function(t,e){},tvR6:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.dfe7398e4b10a62321d0.js.map